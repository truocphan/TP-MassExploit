import platform
import os
import sys
import argparse


py_version = platform.python_version()

pf_system = platform.uname().system.lower()

if platform.machine() in ("i386", "AMD64", "x86_64"):
	pf_machine = "x86_64"
else:
	pf_machine = platform.machine()


python_path = sys.executable

TPMassExploit = os.path.join(os.path.dirname(os.path.abspath(__file__)), "releases", pf_system+"."+pf_machine, py_version, "TP-MassExploit.py")
if pf_system in ["windows"]:
	if " " in python_path:
		python_path = '"'+python_path+'"'

	if " " in TPMassExploit:
		TPMassExploit = '"'+TPMassExploit+'"'
else:
	python_path = python_path.replace(" ","\\ ")

	TPMassExploit = TPMassExploit.replace(" ","\\ ")


parser = argparse.ArgumentParser(add_help=False)
parser.add_argument("-h", "--help", action="store_true")
parser.add_argument("--update", action="store_true")
parser.add_argument("-u", "--url", type=str)
parser.add_argument("-l", "--list-urls", type=str)
parser.add_argument("--show-exploit-ids", action="store_true")
parser.add_argument("--show-all-exploit-ids", action="store_true")
parser.add_argument("--exploit-id", type=str, action="append")
parser.add_argument("--command", type=str)
parser.add_argument("-H", "--Header", type=str, action="append")
parser.add_argument("-t", "--threads", type=int)
parser.add_argument("--delay-time", type=int)
parser.add_argument("--api-server", type=str)
parser.add_argument("--api-key", type=str)
args, unknown = parser.parse_known_args()

if args.help:
	TPMassExploit += " --help"
if args.update:
	os.system("git -C "+os.path.dirname(os.path.abspath(__file__))+" pull")
	exit()
if args.url:
	TPMassExploit += " --url \""+args.url+"\""
if args.list_urls:
	TPMassExploit += " --list-urls \""+args.list_urls+"\""
if args.show_exploit_ids:
	TPMassExploit += " --show-exploit-ids"
if args.show_all_exploit_ids:
	TPMassExploit += " --show-all-exploit-ids"
if args.exploit_id:
	for eid in args.exploit_id:
		TPMassExploit += " --exploit-id \""+eid+"\""
if args.command:
	TPMassExploit += " --command \""+args.command+"\""
if args.Header:
	for h in args.Header:
		TPMassExploit += " --Header \""+h+"\""
if args.threads:
	TPMassExploit += " --threads "+args.threads
if args.delay_time:
	TPMassExploit += " --delay-time "+args.delay_time
if args.api_server:
	TPMassExploit += " --api-server \""+args.api_server+"\""
if args.api_key:
	TPMassExploit += " --api-key \""+args.api_key+"\""

os.system(python_path+" "+TPMassExploit)